<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Mobile-optimized viewport with pull-to-refresh prevention -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover">   

    <!-- PWA and mobile app behaviors -->
    <meta name="theme-color" content="#007bff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Corkt" />

    <!-- Prevent pull-to-refresh and optimize for mobile -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />

    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/favicon.ico" />

    <title>Corkt - Photo Sharing</title>

    <!-- Mobile-specific CSS optimizations -->
    <style>
      /* üîß SAFARI DEBUG: Layout monitoring styles */
      .debug-info {
        position: fixed;
        top: 0;
        right: 0;
        background: rgba(255, 0, 0, 0.8);
        color: white;
        padding: 5px;
        font-size: 10px;
        z-index: 10000;
        font-family: monospace;
        max-width: 150px;
        word-wrap: break-word;
      }

      /* Prevent native pull-to-refresh behaviors */
      html,
      body {
        overscroll-behavior: contain !important;
        overscroll-behavior-y: contain !important;
        position: relative;
        /* üîß SAFARI FIX: Removed conflicting height: 100% */
        margin: 0;
        padding: 0;
        /* üîß SAFARI FIX: Ensure no horizontal overflow */
        max-width: 100vw;
        overflow-x: hidden;
      }

      /* Prevent iOS Safari bounce and zoom */
      body {
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        -webkit-text-size-adjust: none;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        /* üîß SAFARI FIX: Ensure body doesn't exceed viewport */
        width: 100%;
        max-width: 100vw;
        box-sizing: border-box;
      }

      /* Re-enable text selection for specific elements */
      input,
      textarea,
      [contenteditable] {
        -webkit-user-select: text !important;
        user-select: text !important;
      }

      /* Ensure full height on mobile */
      #root {
        /* üîß SAFARI FIX: Simplified height approach */
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height for modern browsers */
        overflow: hidden;
        /* üîß SAFARI FIX: Prevent root from exceeding viewport */
        max-width: 100vw;
        width: 100%;
        box-sizing: border-box;
      }

      /* iOS Safari safe area support */
      @supports (padding: max(0px)) {
        body {
          padding-left: max(0px, env(safe-area-inset-left));
          padding-right: max(0px, env(safe-area-inset-right));
          /* üîß SAFARI FIX: Added top/bottom safe area */
          padding-top: max(0px, env(safe-area-inset-top));
          padding-bottom: max(0px, env(safe-area-inset-bottom));
        }
      }

      /* Smooth scrolling for the entire app */
      * {
        -webkit-overflow-scrolling: touch;
        box-sizing: border-box;
      }

      /* Prevent text selection on UI elements but allow on content */
      button,
      .nav-item,
      .photo-action {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      /* Optimize font rendering on mobile */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
          "Helvetica Neue", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* üîß SAFARI FIX: Updated loading screen positioning */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        /* üîß SAFARI FIX: Changed from width/height 100% to right/bottom 0 */
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 9999;
        /* üîß SAFARI FIX: Added hardware acceleration */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
        /* üîß SAFARI FIX: Ensure no overflow */
        overflow: hidden;
        box-sizing: border-box;
      }

      .loading-logo {
        font-size: 48px;
        font-weight: 300;
        margin-bottom: 20px;
        letter-spacing: 2px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Hide loading screen when React loads */
      .app-loaded .loading-screen {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease-out;
      }
    </style>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LWNJLFB7N9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LWNJLFB7N9');
    </script>
  </head>

  <body>
    <noscript> You need to enable JavaScript to run this app. </noscript>

    <!-- üîß DEBUG: Layout monitoring display -->
    <div class="debug-info" id="debug-info">
      Safari Debug Loading...
    </div>

    <!-- Loading screen shown while React app loads -->
    <div class="loading-screen" id="loading-screen">
      <div class="loading-logo">Corkt</div>
      <div class="loading-spinner"></div>
    </div>

    <div id="root"></div>

    <!-- üîß SAFARI DEBUG: Layout monitoring script -->
    <script>
      console.log("üîç SAFARI DEBUG: Index.html loaded - Version: CACHE_TEST_" + Date.now());
      
      // Layout monitoring function
      function checkLayout() {
        const bodyWidth = document.body.scrollWidth;
        const bodyOffsetWidth = document.body.offsetWidth;
        const windowWidth = window.innerWidth;
        const htmlWidth = document.documentElement.scrollWidth;
        
        const debugInfo = {
          windowWidth: windowWidth,
          bodyScrollWidth: bodyWidth,
          bodyOffsetWidth: bodyOffsetWidth,
          htmlScrollWidth: htmlWidth,
          overflowing: bodyWidth > windowWidth,
          timestamp: new Date().toISOString().substr(11, 8)
        };
        
        // Update debug display
        const debugDiv = document.getElementById("debug-info");
        if (debugDiv) {
          debugDiv.innerHTML = `
            Win: ${debugInfo.windowWidth}<br>
            Body: ${debugInfo.bodyScrollWidth}<br>
            HTML: ${debugInfo.htmlScrollWidth}<br>
            ${debugInfo.overflowing ? 'üö® OVERFLOW!' : '‚úÖ OK'}<br>
            ${debugInfo.timestamp}
          `;
        }
        
        // Console logging
        console.log("üîç Layout Check:", debugInfo);
        
        // Alert if layout breaks
        if (debugInfo.overflowing) {
          console.error("üö® SAFARI LAYOUT BROKE!", debugInfo);
          console.log("üîç Body styles:", getComputedStyle(document.body));
          console.log("üîç HTML styles:", getComputedStyle(document.documentElement));
          console.log("üîç Root styles:", getComputedStyle(document.getElementById('root')));
        }
        
        return debugInfo;
      }
      
      // Check layout every 500ms for the first 10 seconds
      let layoutCheckCount = 0;
      const layoutInterval = setInterval(() => {
        checkLayout();
        layoutCheckCount++;
        if (layoutCheckCount > 20) { // Stop after 10 seconds
          clearInterval(layoutInterval);
          console.log("üîç Layout monitoring stopped after 10 seconds");
        }
      }, 500);
      
      // Initial viewport logging
      console.log("üîç Initial Viewport:", {
        innerWidth: window.innerWidth,
        innerHeight: window.innerHeight,
        devicePixelRatio: window.devicePixelRatio,
        userAgent: navigator.userAgent.substring(0, 100)
      });
    </script>

    <!-- Hide loading screen when React mounts -->
    <script>
      console.log("üîç Loading screen script starting");
      
      // Hide loading screen when React app loads
      window.addEventListener("DOMContentLoaded", function () {
        console.log("üîç DOMContentLoaded fired");
        setTimeout(function () {
          console.log("üîç Hiding loading screen");
          const loadingScreen = document.getElementById("loading-screen");
          if (loadingScreen) {
            loadingScreen.style.opacity = "0";
            setTimeout(function () {
              loadingScreen.style.display = "none";
              console.log("üîç Loading screen hidden");
              // Final layout check after loading screen disappears
              setTimeout(() => {
                console.log("üîç Final layout check after loading screen:");
                checkLayout();
              }, 100);
            }, 500);
          }
        }, 1000); // Show loading for at least 1 second
      });

      // Prevent zoom on iOS Safari
      document.addEventListener("gesturestart", function (e) {
        e.preventDefault();
      });

      // Additional mobile optimizations
      document.addEventListener("touchstart", function () {}, {
        passive: true,
      });
      document.addEventListener("touchmove", function () {}, { passive: true });
    </script>
  </body>
</html>
